@board("canvas")

var screen = new KCanvas(0,0,1024,768)
var grid = MDArray([20,20])
grid.fill(0)
var dir = [0,0]
var pos = [10,10]
var tail = []
tail.push_end(pos)

var PALETTE = [RED,GREEN,BLUE]

var count = 0

fun nth(a,b) { (a mod b) == 0 }

@type('start',setup)
fun setup() {
    //set the edges
    //grid.slice(0,null).set1(1)
    //grid.slice(19,null).set1(1)
    //grid.slice(null,0).set1(1)
    //grid.slice(null,19).set1(1)
    print("done starting")
}

var dpad_current = [1,0]
@type('loop',forever)
fun forever() {
    dir = dpad_current // turns [-1,-1] to [1,1]
	pos = pos + dir
	print("dir",dir,'pos',pos)
	var px = pos.get1(0)
	var py = pos.get1(1)
    if (grid.get2(pos.get1(0),pos.get1(1)) > 0) {
		print("you died")
    	return reset()
    }
    tail.push_end(pos)
	grid.every(@(v,x,y)=> {
	    var color = PALETTE.get1(v)
	    var rect = Rect(x:x*10, y:y*10, w:10, h:10)
	    screen.fillRect(rect,color)
    })
    if not nth(count,10) tail.pop_start()

    print('done')
    wait(1)
}
