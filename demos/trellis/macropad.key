@board("trellis")


@type("start",setup)
fun setup() {
    print("doing the setup")
    device.leds.fill(BLACK)
    wait(0.2)
    device.leds.fill(RED)
    wait(0.2)
    device.leds.fill(GREEN)
    wait(0.2)
    device.leds.fill(BLUE)
    wait(0.2)
    device.leds.fill(BLACK)
    print("setup finishing")
    reset_leds()
}

fun reset_leds() {
    device.leds.set([0,0],RED)
    device.leds.set([0,1],GREEN)
    device.leds.set([0,2],BLUE)
}

var mode = "none"
var fastmouse = "fastmouse"

// 0,0 is blue for mouse
// 0,1 is red for key

@type("loop",lp2)
fun lp2() {
    if mode == "mouse"    device.leds.set([0,0],RED)
    if mode == fastmouse  device.leds.set([0,1],GREEN)
    if mode == "skey"     device.leds.set([0,2],BLUE)
    wait(0.2)
    if mode == "mouse"    device.leds.set([0,0],BLACK)
    if mode == fastmouse  device.leds.set([0,1],BLACK)
    if mode == "skey"     device.leds.set([0,2],BLACK)
    wait(0.2)
}

@type("loop",runmode)
fun runmode() {
    if (mode == "mouse") {
        print("pressing mouse button")
        device.mouse.press(Mouse.LEFT_BUTTON)
        wait(2)
        device.mouse.release_all()
        wait(2)
    }
    if (mode == fastmouse) {
        device.mouse.click(Mouse.LEFT_BUTTON)
        wait(0.1)
    }
}

fun toggle_mode(name) {
    if (mode == name) {
        mode = "none"
    } else {
        mode = name
    }
    reset_leds()
}

@type("loop",loop)
fun loop() {
    device.buttons.pressed_list.each(@(pos) => {
        print("pos is",pos[0], pos[1])
        var x = pos[0]
        var y = pos[1]
        if(x == 0) {
            if y == 0 toggle_mode("mouse")
            if y == 1 toggle_mode("fastmouse")
            if y == 2 toggle_mode("skey")
        }
    })
}

